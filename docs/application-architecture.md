
このドキュメントは本プロジェクトのアプリケーション・アーキテクチャについて記載しています。

# 1. 概要

本ドキュメントは、IT技術系個人ブログアプリケーションのシステムアーキテクチャについて説明します。このアプリケーションは最新のウェブ開発技術を採用し、技術記事の執筆、公開、管理のための効率的なプラットフォームを提供します。

## 2. アーキテクチャの概要

### 2.1 アーキテクチャスタイル

本アプリケーションは、以下のアーキテクチャパターンを組み合わせて構築されています：

- **クリーンアーキテクチャ**: 関心の分離とビジネスロジックの独立を促進するための設計パターン
- **フィーチャベースアーキテクチャ**: 機能ごとにコードを整理するアプローチ
- **サーバーコンポーネント**: App Routerを活用したサーバーサイドレンダリング
- **レポジトリパターン**: データアクセス層の抽象化

## 3. ディレクトリ構造の設計原則

### 3.1 フィーチャベースアーキテクチャ

アプリケーションは、機能（フィーチャ）ごとにコードを整理し、各フィーチャは独立した実装単位として扱われます。これにより、コードの保守性と拡張性が向上します。フィーチャ単位でのコード整理により、関連するコードが近くに配置され、機能間の関係性が明確になります。

主要なフィーチャディレクトリには、記事管理、カテゴリ管理、タグ管理、認証システムなどがあります。

### 3.2 レイヤー分離

各フィーチャ内では、UI層（コンポーネント）、データアクセス層（リポジトリ）、ビジネスロジック層（サービス）、サーバーアクション層、型定義層に分離されています。

この分離により：
- 関心の分離が実現され、テストが容易になる
- 各レイヤーの責務が明確になる
- コードの再利用性が高まる

### 3.3 ディレクトリベースのルーティング

アプリケーションでは、ディレクトリベースのルーティングを採用しています。ディレクトリ構造がそのままURLパスに反映される仕組みです。

主要なルートグループとして、公開サイト用のルート、管理者用のルート、APIエンドポイント用のルートがあります。ルートグループ（括弧付きディレクトリ）を使用することで、論理的に関連するルートをグループ化し、コードの整理を容易にしています。

## 4. レイヤー詳細

### 4.1 プレゼンテーション層

プレゼンテーション層は、ユーザーインターフェイスを担当し、以下のコンポーネントで構成されています：

- **コンテナコンポーネント**: データ取得ロジックとプレゼンテーションコンポーネントを接続するコンポーネント。状態管理やデータフェッチングを担当し、そのデータをプレゼンテーションコンポーネントに渡します。

- **プレゼンテーションコンポーネント**: UI表示に特化した純粋なコンポーネント。受け取ったpropsに基づいて表示を行い、内部状態を持ちません。

このパターンにより、ビジネスロジックとUIを分離し、コンポーネントの再利用性とテスト容易性を高めています。コンテナはデータの取得と加工に集中し、プレゼンテーションはレイアウトとスタイリングに集中します。

### 4.2 サービス層

サービス層はビジネスロジックを担当し、アプリケーションの中核的な処理を実装します。主な役割は：

- リポジトリ層からのデータ取得と加工
- ビジネスルールの適用（バリデーション、計算など）
- トランザクション管理
- 複数のリポジトリにまたがる操作の調整

サービス層は、プレゼンテーション層とデータアクセス層の間に位置し、アプリケーションのコアロジックをカプセル化します。例えば、記事作成時のスラッグ生成や重複チェック、公開設定の管理などの処理がここに含まれます。

### 4.3 リポジトリ層

リポジトリ層はデータアクセスを抽象化し、データベースとの通信を担当します。主な特徴は：

- データの永続化操作（作成、読み取り、更新、削除）を提供
- データベース技術の詳細をサービス層から隠蔽
- ORM（Prisma）を活用したデータアクセスの抽象化
- クエリの最適化と効率的なデータ取得

リポジトリは、特定のエンティティ（記事、カテゴリ、タグなど）に対する操作に特化し、関連するエンティティとの関係も管理します。例えば、記事の取得時にカテゴリやタグの情報も一緒に取得するなどの処理があります。